-var reactions = ['LIKE','LOVE','HAHA','WOW','SAD','ANGRY','SALT']
-var displayReactions = true
-var displayCamera = true
-var displayChat = true
html
	head
		title Social Integration
		link(href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,700,700i" rel="stylesheet")
		link(href="https://fonts.googleapis.com/css?family=Press+Start+2P" rel="stylesheet")
		script(src="https://unpkg.com/vue@2.3.0")
		script(src="https://code.jquery.com/jquery-2.2.4.min.js")
		style
			:stylus
				accentColor = #ff6a00
				saltWidth = 30px
				cameraWidth = 300
				cameraHeight = 180
				reactionsHeight = 70
				spacing = 10
				body
					&,*
						box-sizing border-box
						font-family 'Open Sans', sans-serif
						line-height 1.7rem
						font-weight 400
						margin 0
						padding 0
				.defs-only
					display none
				.relative
					position relative
					top 0
					left 0
					width 100%
					height 100%
				.container
					background url("http://www.nitwitty.net/wp-content/uploads/2016/06/overwatch-ui.jpg") no-repeat center center
					background-size cover
				.cameraZone
					display none
					position absolute
					bottom (spacing + reactionsHeight + spacing)px
					right spacing
					border 4px solid rgba(#000,0.3)
					width cameraWidth px
					height cameraHeight px
					.inner
						position absolute
						top 0
						left 0
						width 100%
						height 100%
						border 2px solid rgba(accentColor,0.6)
						&:after
							content " "
							position absolute
							top -6px
							left -6px
							border 2px solid rgba(darken(accentColor, 50%),0.3)
							width calc(100% + 9px)
							height calc(100% + 9px)
					.nameZone
						position absolute
						bottom 0
						width 100%
						background-color accentColor
						text-align center
						font-family 'Press Start 2P', cursive
						font-size 12px
						text-transform uppercase
						height 25px
						line-height 25px
						box-shadow 0px -2px 2px 0px rgba(#000,.3)
					.accent
						position absolute
						bottom 0
						width 100%
						height 100%
						overflow hidden
						&.right
							transform scaleX(-1)
						&.top
							transform scaleY(-1)
						&.topright
							transform scale(-1,-1)
						.triangle, .rect1, .rect2
							left 0
							bottom 0
							background-color accentColor
							position absolute
							box-shadow 1px 5px 2px 1px rgba(#000,.3)
							transform skew(45deg)
						.triangle
							width 38px
							height 38px
							left -30px
						.rect1
							width 20%
							height 10px
						.rect2
							width 25%
							height 5px
				.reactionsZone
					display none
					justify-content space-between
					position absolute
					right spacing
					bottom spacing
					width cameraWidth
					height reactionsHeight
					background-color #fff
					border-radius 4px
					.reaction
						text-align center
						flex-grow 1
					img
						width 100%
						max-width 50px
						mix-blend-mode: multiply;
					.counter
						margin-top -10px
				.chatZone
					display none
					width cameraWidth
					height 250px
					-webkit-mask-image linear-gradient(to bottom, rgba(#000,0) 10%,rgba(#000,1) 80%)
					overflow hidden
					position absolute
					right 10px
					bottom (spacing + reactionsHeight + spacing + cameraHeight + spacing)px
					color #fff
					flex-flow: column nowrap;
					justify-content: flex-end;
					.row
						&.twitch
							.twitch
								display inline-block
							.author
								background-color #6441A4
						&.facebook
							.facebook
								display inline-block
							.author
								background-color #3B5998
					.time
						font-weight 300
						font-size 10px
						vertical-align middle
						float right
						margin-right 5px
					.source
						display none
						margin 0 5px
						svg
							vertical-align middle
							width 20px
							height 20px
							fill #fff
					.author
						font-weight 400
					.message
						padding 5px
						color #000
						background-color rgba(#fff,0.9)
						font-size 12px
						line-height 12px
	body
		include ../assets/twitch.svg
		include ../assets/facebook.svg
		.container.relative#app
			.chatZone(style=`display:${displayChat?'flex':'none'};`)
				.row(v-for="row in comments",v-bind:class="row.source")
					.author
						i.source.twitch: svg(viewBox="0 0 128 138"): use(xlink:href="#twitch")
						i.source.facebook: svg(viewBox="0 0 258 258"): use(xlink:href="#facebook")
						|{{row.author}}
						span.time {{row.time}}
					.message(v-html="row.message")
			.cameraZone(style=`display:${displayCamera?'flex':'none'};`): .relative
				.inner
				.accent: .relative
					.rect2
					.rect1
					.triangle
				.accent.topright: .relative
					.rect2
					.rect1
					.triangle
			.reactionsZone(style=`display:${displayReactions?'flex':'none'};`)
				for reaction in reactions
					.reaction(class=`${reaction}`)
						img(src=`/${reaction}.gif`)
						.counter {{reactions.#{reaction}}}
		script
			:coffee-script(bare)
				addZ = (i)-> "00#{i}".slice(-2)
				$scope =
					commentsRaw : []
					reactions : []
				$computed =
					comments : ->
						$scope.commentsRaw.map((e)->
							d = new Date(~~e.key)
							return {
								author : e.value.author
								time : "#{addZ(d.getHours())}:#{addZ(d.getMinutes())}"
								message : e.value.message
								source : e.value.source
							}
						).slice(-10)

				app = new Vue
					el : "#app"
					data : $scope
					computed : $computed

				reloadStuff = ->
					console.log 'reloading'
					$.get '/comments', (data)-> $scope.commentsRaw = data
					$.get '/reactions', (data)-> $scope.reactions = data

				setInterval reloadStuff, 1*1000
				reloadStuff()