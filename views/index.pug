html
	head
		title Social Integration
		link(href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,700,700i" rel="stylesheet")
		link(href="https://fonts.googleapis.com/css?family=Press+Start+2P" rel="stylesheet")
		link(href="/style.css" rel="stylesheet")
		script(src="https://unpkg.com/vue@2.3.0")
		script(src="https://code.jquery.com/jquery-2.2.4.min.js")
		

	body
		include ../assets/twitch.svg
		include ../assets/facebook.svg
		.container.relative#app
			.chatZone(style=`display:${displayChat?'flex':'none'};`)
				.row(v-for="row in comments",v-bind:class="row.source")
					.author
						i.source.twitch: svg(viewBox="0 0 128 138"): use(xlink:href="#twitch")
						i.source.facebook: svg(viewBox="0 0 258 258"): use(xlink:href="#facebook")
						|{{row.author}}
						span.time {{row.time}}
					.message(v-html="row.message")
			.cameraZone(style=`display:${displayCamera?'flex':'none'};`): .relative
				.inner
				.accent: .relative
					.rect2
					.rect1
					.triangle
				.accent.topright: .relative
					.rect2
					.rect1
					.triangle
			.reactionsZone(style=`display:${displayReactions?'flex':'none'};`)
				for reaction in reactions
					.reaction(class=`${reaction}`)
						img(src=`/${reaction}.gif`)
						.counter {{reactions.#{reaction}}}
			.newFollowerZone#newFollowerZone: .relative
				.decoration
				.nameZone
					span.span2 New Follower:&nbsp;
					span.name
				.accent: .relative
					.rect2
					.rect1
					.triangle
				.accent.topright: .relative
					.rect2
					.rect1
					.triangle
				
		script
			:coffee-script(bare)
				addZ = (i)-> "00#{i}".slice(-2)
				$scope =
					commentsRaw : []
					reactions : []
				$computed =
					comments : ->
						$scope.commentsRaw.map((e)->
							d = new Date(~~e.key)
							return {
								author : e.value.author
								time : "#{addZ(d.getHours())}:#{addZ(d.getMinutes())}"
								message : e.value.message
								source : e.value.source
							}
						).slice(-10)

				app = new Vue
					el : "#app"
					data : $scope
					computed : $computed

				showingFollower = false

				reloadStuff = ->
					$.get '/comments', (data)-> $scope.commentsRaw = data
					$.get '/reactions', (data)-> $scope.reactions = data
					if !showingFollower
						showingFollower = true
						$.get '/newFollower', (data)->
							if data?.name?
								$('#newFollowerZone .name').text data.name
								$('#newFollowerZone').addClass('animateFollowers')
								setTimeout ->
									$('#newFollowerZone').removeClass('animateFollowers')
									showingFollower = false
								,5000
							else
								showingFollower = false

				setInterval reloadStuff, 1*1000
				reloadStuff()